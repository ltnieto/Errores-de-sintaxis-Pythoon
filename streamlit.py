# -*- coding: utf-8 -*-
"""streamlit.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14yTvZUTvtBEd8YjPHhwUnZbjZWLOA6pJ
"""

import streamlit as st
import ast
import traceback

# Configuraci贸n de la p谩gina de Streamlit
st.set_page_config(
    page_title="CodeSense AI: Analizador de Sintaxis de Python",
    layout="wide",
    initial_sidebar_state="expanded",
)

# Estilos CSS para mejorar la est茅tica
st.markdown("""
<style>
    /* Estilo del t铆tulo principal */
    .big-font {
        font-size:30px !important;
        font-weight: bold;
        color: #FF4B4B; /* Rojo de Streamlit para el acento */
    }
    /* Estilo para los mensajes de 茅xito */
    .success-box {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        padding: 15px;
        border-radius: 5px;
    }
    /* Estilo para los mensajes de error */
    .error-box {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        padding: 15px;
        border-radius: 5px;
    }
    /* Estilo para el 谩rea de c贸digo */
    .stTextArea > label {
        font-weight: bold;
        font-size: 1.1em;
    }
</style>
""", unsafe_allow_html=True)


def analyze_code(code_input: str):
    """
    Analiza la sintaxis del c贸digo Python usando la librer铆a 'ast'
    (Abstract Syntax Tree) para detectar errores sin ejecutar el c贸digo.
    """
    if not code_input.strip():
        return False, "Por favor, introduce c贸digo Python para analizar.", None

    try:
        # Intenta parsear el c贸digo a un rbol de Sintaxis Abstracta (AST).
        # Esto falla inmediatamente si hay un error de sintaxis (SyntaxError).
        ast.parse(code_input)

        # Si el parseo es exitoso, la sintaxis es correcta.
        return True, "隆Sintaxis Correcta! Este fragmento de c贸digo est谩 bien escrito. 隆A帽谩delo a tu proyecto!", None

    except SyntaxError as e:
        # Si ocurre un SyntaxError, lo capturamos.
        error_message = f"Error de Sintaxis detectado en la l铆nea {e.lineno}:\n\n{e.msg}"
        details = traceback.format_exc() # Para ver el detalle completo en la consola (opcional)
        return False, error_message, details

    except Exception as e:
        # Captura otros errores (ej. tabulaciones inconsistentes)
        error_message = f"Error inesperado durante el an谩lisis: {e}"
        details = traceback.format_exc()
        return False, error_message, details


# --- TTULO Y DESCRIPCIN ---
st.markdown('<p class="big-font">CodeSense AI : Analizador de Sintaxis</p>', unsafe_allow_html=True)
st.write("Herramienta r谩pida para verificar si un fragmento de c贸digo Python tiene errores de sintaxis antes de a帽adirlo a tu repositorio.")
st.write("---")

# --- REA DE ENTRADA DE CDIGO ---
# El usuario ingresa el c贸digo en este Text Area
code_input = st.text_area(
    "Pega tu fragmento de c贸digo Python aqu铆:",
    height=250,
    value="""# Ejemplo de c贸digo correcto:
def saludar(nombre):
    print(f"Hola, {nombre}!")

# Ejemplo de c贸digo con error de sintaxis:
# def calcular_area(radio)
#   return 3.14 * radio**2
"""
)

# --- BOTN DE ANLISIS ---
if st.button("Analizar C贸digo", type="primary"):
    is_correct, message, details = analyze_code(code_input)

    # --- RESULTADO ---
    st.write("## Resultado del An谩lisis")

    if is_correct:
        # Si la sintaxis es correcta
        st.markdown(
            f'<div class="success-box">{message}</div>',
            unsafe_allow_html=True
        )
        st.balloons() # Animaci贸n de 茅xito
        st.success("隆Tu c贸digo est谩 listo para el repositorio!")
    else:
        # Si hay un error de sintaxis
        st.markdown(
            f'<div class="error-box"> ERROR DE SINTAXIS </div>',
            unsafe_allow_html=True
        )
        st.warning(message)
        st.error("隆Detente! No subas este c贸digo. Corrige el error antes de continuar.")

        # Mostrar la l铆nea del error para ayudar al usuario
        if "l铆nea" in message:
            try:
                line_number = int(message.split("l铆nea ")[-1].split(":")[0])
                st.info(f"El error probablemente se encuentra cerca de la l铆nea **{line_number}**.")
            except:
                pass

st.write("---")
st.caption("Desarrollado con Streamlit y la librer铆a nativa 'ast' de Python.")g